<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>Blossom ì˜ì–´ í•™ìŠµ</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard/dist/web/variable/pretendardvariable.css">
<style>
  body {
    font-family: "Pretendard Variable", sans-serif;
    margin: 0;
    padding: 0;
    background: #f5f7fb;
  }
  .container {
    max-width: 960px;
    margin: 40px auto;
    padding: 0 20px 60px;
  }
  .title {
    font-size: 26px;
    font-weight: 800;
    margin-bottom: 4px;
  }
  .subtitle {
    font-size: 15px;
    color: #666;
    margin-bottom: 18px;
  }

  /* ëª¨ë“œ íƒ­ 5ê°œ */
  .mode-tabs {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 20px;
  }
  .mode-tab {
    padding: 8px 14px;
    border-radius: 999px;
    border: 1px solid #d1d6ea;
    background: #ffffff;
    font-size: 14px;
    cursor: pointer;
  }
  .mode-tab.active {
    background: #4b7bff;
    border-color: #4b7bff;
    color: #fff;
    font-weight: 600;
  }

  .card {
    background: #ffffff;
    border-radius: 22px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.08);
    padding: 20px 22px;
  }

  .word-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 6px;
  }
  .word-table th, .word-table td {
    padding: 8px 10px;
    font-size: 15px;
    border-bottom: 1px solid #f0f1f7;
  }
  .word-table th {
    background: #f3f5ff;
    text-align: left;
    font-weight: 600;
  }
  .word-table tr:nth-child(even) td {
    background: #fafbff;
  }

  .row {
    margin-top: 8px;
    font-size: 16px;
  }
  .question {
    margin-bottom: 10px;
    font-size: 17px;
    font-weight: 600;
  }
  .choices {
    display: flex;
    flex-direction: column;
    gap: 6px;
    margin-top: 6px;
  }
  .choice-btn {
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px solid #d1d6ea;
    background: #ffffff;
    cursor: pointer;
    text-align: left;
    font-size: 15px;
  }
  .choice-btn.correct {
    background: #e3f7e6;
    border-color: #51b36c;
  }
  .choice-btn.wrong {
    background: #ffe5e5;
    border-color: #f08484;
  }

  .input-row {
    display: flex;
    gap: 8px;
    margin-top: 10px;
    flex-wrap: wrap;
  }
  .text-input {
    flex: 1;
    min-width: 180px;
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px solid #cfd3e6;
    font-size: 15px;
  }
  .btn {
    padding: 8px 14px;
    border-radius: 999px;
    border: none;
    cursor: pointer;
    font-size: 14px;
  }
  .btn-primary {
    background: #4b7bff;
    color: #fff;
  }
  .btn-secondary {
    background: #edf0ff;
    color: #3a4d9b;
  }
  .feedback {
    margin-top: 8px;
    font-size: 14px;
  }
  .feedback.ok {
    color: #2f8f4e;
  }
  .feedback.no {
    color: #d83939;
  }

  .tag {
    display: inline-block;
    margin-top: 6px;
    padding: 4px 10px;
    border-radius: 999px;
    font-size: 12px;
    background: #e4ecff;
    color: #3554c9;
  }
</style>
</head>
<body>
<div class="container">
  <div class="title" id="titleText">Blossom ì˜ì–´ í•™ìŠµ</div>
  <div class="subtitle" id="subtitleText"></div>

  <!-- 5ê°œ ëª¨ë“œ íƒ­ -->
  <div class="mode-tabs">
    <button class="mode-tab active" data-mode="view">â‘  ì–´íœ˜ í•™ìŠµ</button>
    <button class="mode-tab" data-mode="meaning">â‘¡ ëœ» ì°¾ê¸°</button>
    <button class="mode-tab" data-mode="english">â‘¢ ì˜ì–´ ì°¾ê¸°</button>
    <button class="mode-tab" data-mode="listen">â‘£ ë“£ê³  ì°¾ê¸°</button>
    <button class="mode-tab" data-mode="sentence">â‘¤ ë¬¸ì¥ ë¹ˆì¹¸ ë°›ì•„ì“°ê¸°</button>
  </div>

  <!-- ë©”ì¸ ì¹´ë“œ -->
  <div class="card" id="cardArea"></div>
</div>

<script>
  // ======= 0. URLì—ì„œ ë‹¨ê³„/ìœ ë‹› ì½ê¸° =======
  const params = new URLSearchParams(location.search);
  const stage = params.get("stage") || "1";
  const unit = params.get("unit") || "1";

  document.getElementById("titleText").innerText = `${stage}ë‹¨ê³„ ${unit}ìœ ë‹› í•™ìŠµ`;
  document.getElementById("subtitleText").innerText = "ì›í•˜ëŠ” ëª¨ë“œë¥¼ ê³¨ë¼ì„œ ì—°ìŠµí•´ë³´ì„¸ìš”.";

  // ======= 1. ì˜ˆì‹œ ë‹¨ì–´ ë¦¬ìŠ¤íŠ¸ (ë‚˜ì¤‘ì— êµì²´ ê°€ëŠ¥) =======
  // ì¼ë‹¨ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ 6ê°œë§Œ ì‚¬ìš©
  const WORDS = [
    {
      en: "at",
      ko: "~ì—",
      sentence: "I will meet you ___ the park."
    },
    {
      en: "bat",
      ko: "ì•¼êµ¬ë°©ë§ì´, ë°•ì¥",
      sentence: "He swings the ___ very well."
    },
    {
      en: "hat",
      ko: "ëª¨ì",
      sentence: "She is wearing a red ___."
    },
    {
      en: "run",
      ko: "ë‹¬ë¦¬ë‹¤",
      sentence: "They ___ to school every morning."
    },
    {
      en: "bag",
      ko: "ê°€ë°©",
      sentence: "Put the books in your ___."
    },
    {
      en: "pig",
      ko: "ë¼ì§€",
      sentence: "The ___ is very cute."
    }
  ];

  // ìœ ë‹› ë²ˆí˜¸ì— ë”°ë¼ ë‚˜ì¤‘ì— sliceë¡œ ë‹¤ë¥¸ êµ¬ê°„ ì‚¬ìš© ê°€ëŠ¥
  const words = WORDS; // ì§€ê¸ˆì€ ì „ì²´ ì‚¬ìš©

  // ======= 2. ëª¨ë“œ ìƒíƒœ =======
  let currentMode = "view";
  let currentIndex = 0;

  const cardArea = document.getElementById("cardArea");
  const modeTabs = document.querySelectorAll(".mode-tab");

  modeTabs.forEach(tab => {
    tab.addEventListener("click", () => {
      modeTabs.forEach(t => t.classList.remove("active"));
      tab.classList.add("active");
      currentMode = tab.dataset.mode;
      currentIndex = 0;
      renderMode();
    });
  });

  // ======= 3. ê³µí†µ TTS í•¨ìˆ˜ =======
  function speak(text, repeat = 1) {
    if (!("speechSynthesis" in window)) return;
    window.speechSynthesis.cancel();
    let count = 0;
    function speakOnce() {
      if (count >= repeat) return;
      const u = new SpeechSynthesisUtterance(text);
      u.lang = "en-US";
      u.rate = 0.9;
      u.onend = () => {
        count++;
        speakOnce();
      };
      window.speechSynthesis.speak(u);
    }
    speakOnce();
  }

  // ======= 4. ëª¨ë“œë³„ ë Œë” =======
  function renderMode() {
    if (currentMode === "view") {
      renderViewMode();
    } else if (currentMode === "meaning") {
      renderMeaningMode();
    } else if (currentMode === "english") {
      renderEnglishMode();
    } else if (currentMode === "listen") {
      renderListenMode();
    } else if (currentMode === "sentence") {
      renderSentenceMode();
    }
  }

  // â‘  ì–´íœ˜ í•™ìŠµ: ì˜ì–´+ëœ» ì „ì²´ ë³´ê¸° + ìë™ ì¬ìƒ
  function renderViewMode() {
    let html = `
      <div class="row">
        <strong>â‘  ì–´íœ˜ í•™ìŠµ</strong><br>
        ì˜ì–´ ë‹¨ì–´ì™€ ëœ»ì„ ë¨¼ì € ëˆˆìœ¼ë¡œ ë³´ê³ , ë°œìŒì„ ë“¤ì–´ë³¼ê²Œìš”.
      </div>
      <div class="row">
        <button class="btn btn-secondary" id="btnPlayAll">ì „ì²´ ë‹¤ì‹œ ë“£ê¸°</button>
        <span class="tag">í˜ì´ì§€ë¥¼ ì—´ë©´ ìë™ìœ¼ë¡œ ë‹¨ì–´ê°€ ìˆœì„œëŒ€ë¡œ 2ë²ˆì”© ì¬ìƒë¼ìš”.</span>
      </div>
      <table class="word-table">
        <tr><th>ì˜ì–´</th><th>ëœ»</th></tr>
    `;
    words.forEach(w => {
      html += `<tr><td>${w.en}</td><td>${w.ko}</td></tr>`;
    });
    html += `</table>`;
    cardArea.innerHTML = html;

    // ìë™ ì¬ìƒ
    playAllWordsTwice();

    // ë‹¤ì‹œ ë“£ê¸° ë²„íŠ¼
    document.getElementById("btnPlayAll").onclick = playAllWordsTwice;
  }

  function playAllWordsTwice() {
    if (!("speechSynthesis" in window)) return;
    window.speechSynthesis.cancel();

    let i = 0;
    function speakNext() {
      if (i >= words.length) return;
      const word = words[i].en;
      const u1 = new SpeechSynthesisUtterance(word);
      const u2 = new SpeechSynthesisUtterance(word);
      u1.lang = "en-US";
      u2.lang = "en-US";
      u1.onend = () => window.speechSynthesis.speak(u2);
      u2.onend = () => {
        i++;
        speakNext();
      };
      window.speechSynthesis.speak(u1);
    }
    speakNext();
  }

  // â‘¡ ëœ» ì°¾ê¸°: ì˜ì–´ â†’ ëœ» ë³´ê¸° / ì„ íƒ (ê°„ë‹¨ ë²„ì „: ì…ë ¥ì€ ì•ˆì±„ì , ë³´ê¸°ë¡œ ì •ë‹µ ì•ˆë‚´)
  function renderMeaningMode() {
    const w = words[currentIndex];
    let html = `
      <div class="question">â‘¡ ëœ» ì°¾ê¸°</div>
      <div class="row">ì˜ì–´ ë‹¨ì–´ì˜ ëœ»ì„ ë§í˜€ë³´ì„¸ìš”.</div>
      <div class="row"><strong>ë‹¨ì–´: ${w.en}</strong></div>

      <div class="input-row">
        <button class="btn btn-secondary" id="btnShowKo">ëœ» ë³´ê¸°</button>
        <button class="btn btn-primary" id="btnNext">ë‹¤ìŒ ë‹¨ì–´</button>
      </div>
      <div class="feedback" id="fbMeaning"></div>
    `;
    cardArea.innerHTML = html;

    document.getElementById("btnShowKo").onclick = () => {
      document.getElementById("fbMeaning").innerHTML =
        `<span class="ok">ì •ë‹µ: ${w.ko}</span>`;
    };
    document.getElementById("btnNext").onclick = () => {
      currentIndex = (currentIndex + 1) % words.length;
      renderMeaningMode();
    };
  }

  // â‘¢ ì˜ì–´ ì°¾ê¸°: ëœ» â†’ ì˜ì–´ ì…ë ¥, ì±„ì 
  function renderEnglishMode() {
    const w = words[currentIndex];
    let html = `
      <div class="question">â‘¢ ì˜ì–´ ì°¾ê¸°</div>
      <div class="row">ëœ»ì„ ë³´ê³  ì•Œë§ì€ ì˜ì–´ ë‹¨ì–´ë¥¼ ì¨ë³´ì„¸ìš”.</div>
      <div class="row"><strong>ëœ»: ${w.ko}</strong></div>

      <div class="input-row">
        <input type="text" class="text-input" id="inputEn" placeholder="ì˜ì–´ ë‹¨ì–´ ì…ë ¥">
        <button class="btn btn-primary" id="btnCheck">ì •ë‹µ í™•ì¸</button>
        <button class="btn btn-secondary" id="btnNext">ë‹¤ìŒ</button>
      </div>
      <div class="feedback" id="fbEn"></div>
    `;
    cardArea.innerHTML = html;

    document.getElementById("btnCheck").onclick = () => {
      const value = (document.getElementById("inputEn").value || "").trim().toLowerCase();
      const answer = w.en.toLowerCase();
      const fb = document.getElementById("fbEn");
      if (value === answer) {
        fb.className = "feedback ok";
        fb.innerText = "ì •ë‹µì´ì—ìš”! ğŸ˜Š";
      } else {
        fb.className = "feedback no";
        fb.innerText = `ì•„ì‰¬ì›Œìš” ğŸ˜¥ ì •ë‹µì€ "${w.en}" ì…ë‹ˆë‹¤.`;
      }
    };
    document.getElementById("btnNext").onclick = () => {
      currentIndex = (currentIndex + 1) % words.length;
      renderEnglishMode();
    };
  }

  // â‘£ ë“£ê³  ì°¾ê¸°: ë°œìŒ ë“£ê³  ì˜ì–´ ì“°ê¸°
  function renderListenMode() {
    const w = words[currentIndex];
    let html = `
      <div class="question">â‘£ ë“£ê³  ì°¾ê¸°</div>
      <div class="row">ë°œìŒì„ ë“£ê³  ì–´ë–¤ ë‹¨ì–´ì¸ì§€ ë§í˜€ë³´ì„¸ìš”.</div>

      <div class="input-row">
        <button class="btn btn-secondary" id="btnPlay">ğŸ”Š ë°œìŒ ë“£ê¸°</button>
        <input type="text" class="text-input" id="inputListen" placeholder="ì˜ì–´ ë‹¨ì–´ ì…ë ¥">
        <button class="btn btn-primary" id="btnCheck">ì •ë‹µ í™•ì¸</button>
        <button class="btn btn-secondary" id="btnNext">ë‹¤ìŒ</button>
      </div>
      <div class="feedback" id="fbListen"></div>
    `;
    cardArea.innerHTML = html;

    document.getElementById("btnPlay").onclick = () => speak(w.en, 2);
    document.getElementById("btnCheck").onclick = () => {
      const value = (document.getElementById("inputListen").value || "").trim().toLowerCase();
      const answer = w.en.toLowerCase();
      const fb = document.getElementById("fbListen");
      if (value === answer) {
        fb.className = "feedback ok";
        fb.innerText = "ì •ë‹µ! ê·€ê°€ ì•„ì£¼ ì¢‹ì•„ìš” ğŸ‘‚âœ¨";
      } else {
        fb.className = "feedback no";
        fb.innerText = `ì •ë‹µì€ "${w.en}" ì…ë‹ˆë‹¤.`;
      }
    };
    document.getElementById("btnNext").onclick = () => {
      currentIndex = (currentIndex + 1) % words.length;
      renderListenMode();
    };

    // í˜ì´ì§€ ë“¤ì–´ì˜¤ë©´ ìë™ìœ¼ë¡œ í•œ ë²ˆ ì¬ìƒ
    speak(w.en, 2);
  }

  // â‘¤ ë¬¸ì¥ ë¹ˆì¹¸ ë°›ì•„ì“°ê¸°
  function renderSentenceMode() {
    const w = words[currentIndex];
    // ë¬¸ì¥ ì•ˆì˜ ë‹¨ì–´ë¥¼ ___ ë¡œ ê°€ë ¤ì£¼ê¸°
    const original = w.sentence;
    const blankSentence = original.replace(w.en, "___");

    let html = `
      <div class="question">â‘¤ ë¬¸ì¥ ë¹ˆì¹¸ ë°›ì•„ì“°ê¸°</div>
      <div class="row">ë¬¸ì¥ì„ ë“£ê³  ë¹ˆì¹¸ì— ë“¤ì–´ê°ˆ ë‹¨ì–´ë¥¼ ì¨ë³´ì„¸ìš”.</div>

      <div class="row"><strong>${blankSentence}</strong></div>

      <div class="input-row">
        <button class="btn btn-secondary" id="btnPlaySentence">ğŸ”Š ë¬¸ì¥ ë“£ê¸°</button>
        <input type="text" class="text-input" id="inputSentence" placeholder="ë¹ˆì¹¸ì— ë“¤ì–´ê°ˆ ì˜ì–´ ë‹¨ì–´">
        <button class="btn btn-primary" id="btnCheck">ì •ë‹µ í™•ì¸</button>
        <button class="btn btn-secondary" id="btnNext">ë‹¤ìŒ</button>
      </div>
      <div class="feedback" id="fbSentence"></div>
    `;
    cardArea.innerHTML = html;

    document.getElementById("btnPlaySentence").onclick = () => {
      speak(original, 1);
    };
    document.getElementById("btnCheck").onclick = () => {
      const value = (document.getElementById("inputSentence").value || "").trim().toLowerCase();
      const answer = w.en.toLowerCase();
      const fb = document.getElementById("fbSentence");
      if (value === answer) {
        fb.className = "feedback ok";
        fb.innerText = "ì •ë‹µì´ì—ìš”! ë©‹ì§€ê²Œ ë“¤ìœ¼ì…¨ë„¤ìš” ğŸ‘";
      } else {
        fb.className = "feedback no";
        fb.innerText = `ì •ë‹µì€ "${w.en}" ì´ê³ , ì „ì²´ ë¬¸ì¥ì€ "${original}" ì´ì—ìš”.`;
      }
    };
    document.getElementById("btnNext").onclick = () => {
      currentIndex = (currentIndex + 1) % words.length;
      renderSentenceMode();
    };

    // ë“¤ì–´ì˜¤ë©´ ìë™ìœ¼ë¡œ ë¬¸ì¥ í•œ ë²ˆ ì¬ìƒ
    speak(original, 1);
  }

  // ì²« ì§„ì…ì€ ì–´íœ˜ í•™ìŠµ ëª¨ë“œ
  renderMode();
</script>
</body>
</html>