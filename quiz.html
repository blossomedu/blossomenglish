<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë¸”ë¼ì¸ ë‹¨ì–´ í•™ìŠµ</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard/dist/web/variable/pretendardvariable.css">
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      font-family: "Pretendard Variable", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f5f7fb;
      color: #111827;
    }
    .page {
      max-width: 980px;
      margin: 40px auto;
      padding: 0 20px 40px;
    }
    .top-line {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
    }
    .breadcrumb {
      font-size: 14px;
      color: #6b7280;
    }
    h1 {
      margin: 0 0 6px;
      font-size: 30px;
      font-weight: 800;
    }
    .subtitle {
      font-size: 15px;
      color: #6b7280;
      margin-bottom: 18px;
    }

    .mode-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 18px;
    }
    .mode-btn {
      border-radius: 999px;
      border: none;
      padding: 8px 14px;
      font-size: 14px;
      cursor: pointer;
      background: #e5e7eb;
      color: #374151;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .mode-btn.active {
      background: #2563eb;
      color: #fff;
      box-shadow: 0 4px 14px rgba(37,99,235,0.35);
    }

    .card {
      background: #ffffff;
      border-radius: 26px;
      box-shadow: 0 12px 32px rgba(15,23,42,0.12);
      padding: 28px 26px 24px;
      min-height: 260px;
    }

    .quiz-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 6px;
    }
    .quiz-sub {
      font-size: 14px;
      color: #6b7280;
      margin-bottom: 18px;
    }

    /* --- ì–´íœ˜ í•™ìŠµ ì¹´ë“œ --- */
    .center-box {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      margin-top: 10px;
    }
    .word-en {
      font-size: 52px;
      font-weight: 800;
      margin: 36px 0 18px;
    }
    .divider {
      width: 100%;
      height: 1px;
      background: #e5e7eb;
      margin-bottom: 22px;
    }
    .meaning-wrap {
      position: relative;
      width: 100%;
      max-width: 520px;
      height: 140px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .meaning-ko {
      font-size: 30px;
      font-weight: 600;
      padding: 0 8px;
    }
    .cover {
      position: absolute;
      inset: 0;
      border-radius: 18px;
      background: #22c55e;
      color: #ffffff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.18s ease;
    }
    .cover small {
      margin-top: 3px;
      opacity: 0.9;
      font-size: 13px;
    }
    .cover.hidden {
      opacity: 0;
      pointer-events: none;
    }
    .helper-text {
      margin-top: 16px;
      font-size: 14px;
      color: #6b7280;
    }
    .progress {
      margin-top: 8px;
      font-size: 13px;
      color: #9ca3af;
    }
    .icon-btn {
      border: none;
      background: none;
      font-size: 22px;
      cursor: pointer;
    }

    /* ì˜µì…˜ ê³µí†µ */
    .question-main {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 10px;
    }
    .question-big {
      font-size: 30px;
      font-weight: 800;
      margin-bottom: 16px;
    }
    .options {
      display: flex;
      flex-direction: column;
      gap: 9px;
      margin-bottom: 10px;
    }
    .opt-btn {
      border-radius: 999px;
      padding: 9px 14px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      cursor: pointer;
      font-size: 15px;
      text-align: left;
      transition: all 0.14s ease;
    }
    .opt-btn:hover {
      background: #eef2ff;
      border-color: #c7d2fe;
    }
    .opt-btn.correct {
      background: #dcfce7;
      border-color: #16a34a;
      color: #166534;
    }
    .opt-btn.wrong {
      background: #fee2e2;
      border-color: #ef4444;
      color: #b91c1c;
    }
    .feedback {
      font-size: 14px;
      margin-top: 4px;
      margin-bottom: 8px;
    }
    .feedback.good { color: #15803d; }
    .feedback.bad { color: #b91c1c; }
    .status {
      font-size: 13px;
      color: #6b7280;
    }
    .btn-row {
      margin-top: 10px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .btn {
      border-radius: 999px;
      border: none;
      padding: 8px 14px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      background: #2563eb;
      color: #fff;
    }
    .btn.secondary {
      background: #e5e7eb;
      color: #111827;
    }

    /* ë¬¸ì¥ ë¹ˆì¹¸ */
    .sentence-en {
      font-size: 18px;
      margin-bottom: 8px;
    }
    .sentence-kr {
      font-size: 14px;
      color: #6b7280;
      margin-bottom: 12px;
    }
    .blank-input {
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 8px 12px;
      font-size: 15px;
      outline: none;
      min-width: 180px;
    }
    .blank-input:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37,99,235,0.25);
    }

    @media (max-width: 640px) {
      .word-en { font-size: 40px; }
      .meaning-ko { font-size: 24px; }
      .question-big { font-size: 24px; }
    }
  </style>
</head>
<body>
<div class="page">
  <div class="top-line">
    <div>
      <div class="breadcrumb" id="breadcrumb">ë‹¨ê³„ Â· ìœ ë‹›</div>
      <h1 id="title">ë‹¨ì–´ í•™ìŠµ</h1>
      <div class="subtitle" id="subtitle">ë‹¨ì–´ í•™ìŠµ ëª¨ë“œë¥¼ ì„ íƒí•´ ë³´ì„¸ìš”.</div>
    </div>
    <button class="icon-btn" id="soundBtn" title="í˜„ì¬ ë‹¨ì–´ ë°œìŒ ë‹¤ì‹œ ë“£ê¸°">ğŸ”Š</button>
  </div>

  <div class="mode-bar">
    <button class="mode-btn active" data-mode="vocab">ğŸ“š ì–´íœ˜ í•™ìŠµ</button>
    <button class="mode-btn" data-mode="meaning">âœ… ëœ» ì°¾ê¸°</button>
    <button class="mode-btn" data-mode="english">ğŸ”¤ ì˜ì–´ ì°¾ê¸°</button>
    <button class="mode-btn" data-mode="listen">ğŸ§ ë“£ê³  ì°¾ê¸°</button>
    <button class="mode-btn" data-mode="sentence">âœï¸ ë¬¸ì¥ ë¹ˆì¹¸</button>
  </div>

  <div class="card" id="cardArea">
    <!-- JSë¡œ ë‚´ìš©ì´ ì±„ì›Œì§ -->
    ë¡œë”© ì¤‘ì…ë‹ˆë‹¤...
  </div>
</div>

<!-- ì—‘ì…€ ì½ê¸° ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script>
  /************* ê³µí†µ: URL íŒŒë¼ë¯¸í„° *************/
  const params = new URLSearchParams(location.search);
  const unitParam = params.get("unit") || "1-1";  // ì˜ˆ: 1-1
  const stageParam = unitParam.split("-")[0] || "1";

  document.getElementById("breadcrumb").innerText = `${stageParam}ë‹¨ê³„ Â· ${unitParam} ìœ ë‹›`;
  document.getElementById("title").innerText = `${unitParam} ë‹¨ì–´ í•™ìŠµ`;

  /************* ì—‘ì…€ì—ì„œ ë°ì´í„° ì½ê¸° *************/
  async function loadWordsForUnit(unitCode) {
    const res = await fetch("words.xlsx");   // ê°™ì€ í´ë”ì— ìˆì–´ì•¼ í•¨
    const buf = await res.arrayBuffer();
    const wb = XLSX.read(buf);
    const sheetName = wb.SheetNames[0];      // ì²« ë²ˆì§¸ ì‹œíŠ¸ ì‚¬ìš©
    const sheet = wb.Sheets[sheetName];

    // header:1 â†’ 2ì°¨ì› ë°°ì—´ í˜•íƒœë¡œ ì½ê¸°
    const rows = XLSX.utils.sheet_to_json(sheet, { header: 1, defval: "" });

    // 0ë²ˆ í–‰ì€ í—¤ë” (ë²ˆí˜¸, ì˜ì–´, í•œê¸€, ì˜ˆë¬¸, í•œê¸€(ì˜ˆë¬¸í•´ì„))
    const dataRows = rows.slice(1);

    const filtered = dataRows
      .filter(r => (r[0] + "").trim() === unitCode)  // r[0] = ë²ˆí˜¸
      .map(r => ({
        unit:  (r[0] + "").trim(),
        eng:   (r[1] + "").trim(),
        kor:   (r[2] + "").trim(),
        ex_en: (r[3] + "").trim(),
        ex_kr: (r[4] + "").trim(),
      }))
      .filter(row => row.eng);  // ì˜ì–´ê°€ ë¹„ì–´ ìˆìœ¼ë©´ ì œì™¸

    return filtered;
  }

  /************* ìŒì„± ì¬ìƒ *************/
  function speak(text, repeat = 1, rate = 0.9) {
    if (!("speechSynthesis" in window)) return;
    speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "en-US";
    u.rate = rate;
    let count = 0;
    u.onend = () => {
      count++;
      if (count < repeat) speechSynthesis.speak(u);
    };
    speechSynthesis.speak(u);
  }

  let WORDS = [];
  let currentMode = "vocab";
  let currentIndex = 0;

  const cardArea = document.getElementById("cardArea");
  const soundBtn = document.getElementById("soundBtn");

  /************* 1. ì–´íœ˜ í•™ìŠµ (ìŠ¤í˜ì´ìŠ¤/í´ë¦­ìœ¼ë¡œ ëœ» ë³´ê¸°) *************/
  function renderVocabMode() {
    currentMode = "vocab";
    cardArea.innerHTML = "";

    if (!WORDS.length) {
      cardArea.textContent = "ì´ ìœ ë‹›ì— ë‹¨ì–´ê°€ ì—†ì–´ìš”.";
      return;
    }

    currentIndex = 0;
    let isRevealed = false;

    const title = document.createElement("div");
    title.className = "quiz-title";
    title.textContent = "ì–´íœ˜ í•™ìŠµ";

    const sub = document.createElement("div");
    sub.className = "quiz-sub";
    sub.textContent = "ë‹¨ì–´ ë°œìŒì„ ìë™ìœ¼ë¡œ ë‘ ë²ˆ ë“£ê³ , í´ë¦­ ë˜ëŠ” ìŠ¤í˜ì´ìŠ¤ë°”ë¡œ ëœ»ì„ í™•ì¸í•´ìš”.";

    const box = document.createElement("div");
    box.className = "center-box";

    const wordEnEl = document.createElement("div");
    wordEnEl.className = "word-en";

    const divider = document.createElement("div");
    divider.className = "divider";

    const meaningWrap = document.createElement("div");
    meaningWrap.className = "meaning-wrap";

    const meaningKoEl = document.createElement("div");
    meaningKoEl.className = "meaning-ko";

    const cover = document.createElement("div");
    cover.className = "cover";
    cover.innerHTML = `í´ë¦­í•´ì„œ ëœ»ì„ í™•ì¸í•˜ì„¸ìš”.<small>(ë˜ëŠ” ìŠ¤í˜ì´ìŠ¤ë°”)</small>`;

    const helper = document.createElement("div");
    helper.className = "helper-text";
    helper.innerHTML = "ëœ»ì„ ë³¸ ë’¤ ë‹¤ì‹œ í´ë¦­í•˜ê±°ë‚˜ ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ëˆ„ë¥´ë©´ ë‹¤ìŒ ë‹¨ì–´ë¡œ ë„˜ì–´ê°€ìš”.";

    const progress = document.createElement("div");
    progress.className = "progress";

    meaningWrap.appendChild(meaningKoEl);
    meaningWrap.appendChild(cover);

    box.appendChild(wordEnEl);
    box.appendChild(divider);
    box.appendChild(meaningWrap);
    box.appendChild(helper);
    box.appendChild(progress);

    cardArea.appendChild(title);
    cardArea.appendChild(sub);
    cardArea.appendChild(box);

    function showWord() {
      const w = WORDS[currentIndex];
      wordEnEl.textContent = w.eng;
      meaningKoEl.textContent = w.kor;
      cover.classList.remove("hidden");
      isRevealed = false;
      progress.textContent = `${currentIndex + 1} / ${WORDS.length} ë‹¨ì–´`;
      speak(w.eng, 2, 0.9);  // ë‘ ë²ˆ ìë™ ì¬ìƒ
    }

    function handleAction() {
      if (!isRevealed) {
        cover.classList.add("hidden");
        isRevealed = true;
      } else {
        currentIndex++;
        if (currentIndex < WORDS.length) {
          showWord();
        } else {
          progress.textContent = "ëª¨ë“  ë‹¨ì–´ í•™ìŠµì„ ì™„ë£Œí–ˆì–´ìš”! ğŸ‰";
        }
      }
    }

    cover.addEventListener("click", handleAction);
    document.onkeydown = (e) => {
      if (currentMode !== "vocab") return;
      if (e.code === "Space") {
        e.preventDefault();
        handleAction();
      }
    };

    soundBtn.onclick = () => {
      if (!WORDS.length) return;
      const w = WORDS[currentIndex];
      speak(w.eng, 1, 0.9);
    };

    showWord();
  }

  /************* ê³µí†µ: ê°ê´€ì‹ í€´ì¦ˆ UI ìƒì„± *************/
  function createChoiceQuiz({ titleText, description, getQuestionText, getBigText, getOptionText, checkCorrect, withSound }) {
    cardArea.innerHTML = "";

    if (!WORDS.length) {
      cardArea.textContent = "ì´ ìœ ë‹›ì— ë‹¨ì–´ê°€ ì—†ì–´ìš”.";
      return;
    }

    let order = shuffle(WORDS);
    let idx = 0;
    let score = 0;

    const title = document.createElement("div");
    title.className = "quiz-title";
    title.textContent = titleText;

    const sub = document.createElement("div");
    sub.className = "quiz-sub";
    sub.textContent = description;

    const qMain = document.createElement("div");
    qMain.className = "question-main";

    const qBig = document.createElement("div");
    qBig.className = "question-big";

    const optionsWrap = document.createElement("div");
    optionsWrap.className = "options";

    const feedback = document.createElement("div");
    feedback.className = "feedback";

    const status = document.createElement("div");
    status.className = "status";

    const btnRow = document.createElement("div");
    btnRow.className = "btn-row";

    const nextBtn = document.createElement("button");
    nextBtn.className = "btn secondary";
    nextBtn.textContent = "ë‹¤ìŒ";
    nextBtn.disabled = true;

    const replayBtn = document.createElement("button");
    replayBtn.className = "btn secondary";
    replayBtn.textContent = "ë‹¤ì‹œ ë“£ê¸°";
    if (!withSound) replayBtn.style.display = "none";

    btnRow.appendChild(nextBtn);
    btnRow.appendChild(replayBtn);

    cardArea.appendChild(title);
    cardArea.appendChild(sub);
    cardArea.appendChild(qMain);
    cardArea.appendChild(qBig);
    cardArea.appendChild(optionsWrap);
    cardArea.appendChild(feedback);
    cardArea.appendChild(status);
    cardArea.appendChild(btnRow);

    function renderQuestion() {
      feedback.textContent = "";
      feedback.className = "feedback";
      nextBtn.disabled = true;
      optionsWrap.innerHTML = "";

      if (idx >= order.length) {
        qMain.textContent = "ìˆ˜ê³ í–ˆì–´ìš”!";
        qBig.textContent = "";
        status.textContent = `ì´ ${order.length}ë¬¸ì œ ì¤‘ ${score}ë¬¸ì œë¥¼ ë§í˜”ì–´ìš”.`;
        nextBtn.textContent = "ë‹¤ì‹œ í•˜ê¸°";
        nextBtn.disabled = false;
        replayBtn.style.display = "none";

        nextBtn.onclick = () => {
          order = shuffle(WORDS);
          idx = 0;
          score = 0;
          nextBtn.textContent = "ë‹¤ìŒ";
          replayBtn.style.display = withSound ? "inline-flex" : "none";
          renderQuestion();
        };
        return;
      }

      const word = order[idx];
      qMain.textContent = getQuestionText(word);
      qBig.textContent = getBigText(word);

      let wrongs = shuffle(WORDS.filter(w => w !== word)).slice(0, Math.min(3, WORDS.length - 1));
      const choices = shuffle([word, ...wrongs]);

      let locked = false;
      choices.forEach(ch => {
        const btn = document.createElement("button");
        btn.className = "opt-btn";
        btn.textContent = getOptionText(ch);
        btn.onclick = () => {
          if (locked) return;
          locked = true;
          const ok = checkCorrect(word, ch);
          if (ì˜¤ì¼€ì´) {
            btn.classList.add("correct");
            feedback.classList.add("good");
            feedback.textContent = "ì •ë‹µì´ì—ìš”! ğŸ˜Š";
            score++;
          } else {
            btn.classList.add("wrong");
            feedback.classList.add("bad");
            feedback.textContent = `ì•„ì‰¬ì›Œìš”. ì •ë‹µì€ "${getOptionText(word)}"ì˜€ì–´ìš”.`;
          }
          nextBtn.disabled = false;
          status.textContent = `${idx + 1} / ${order.length} ë¬¸ì œ`;
        };
        optionsWrap.appendChild(btn);
      });

      if (withSound) {
        speak(word.eng, 2, 0.95);
        replayBtn.onclick = () => speak(word.eng, 2, 0.95);
      }

      nextBtn.onclick = () => {
        idx++;
        renderQuestion();
      };

      status.textContent = `${idx + 1} / ${order.length} ë¬¸ì œ`;
    }

    renderQuestion();
  }

  /************* 2. ëœ» ì°¾ê¸° (ì˜ì–´ â†’ í•œê¸€) *************/
  function renderMeaningMode() {
    currentMode = "meaning";
    document.onkeydown = null;
    soundBtn.onclick = null;
    createChoiceQuiz({
      titleText: "ëœ» ì°¾ê¸°",
      description: "ì˜ì–´ ë‹¨ì–´ë¥¼ ë³´ê³  ì•Œë§ì€ í•œê¸€ ëœ»ì„ ê³¨ë¼ìš”.",
      getQuestionText: (w) => `"${w.eng}" ì˜ ëœ»ì€ ë¬´ì—‡ì¼ê¹Œìš”?`,
      getBigText: (w) => w.eng,
      getOptionText: (w) => w.kor,
      checkCorrect: (answer, picked) => answer === picked,
      withSound: false
    });
  }

  /************* 3. ì˜ì–´ ì°¾ê¸° (í•œê¸€ â†’ ì˜ì–´) *************/
  function renderEnglishMode() {
    currentMode = "english";
    document.onkeydown = null;
    soundBtn.onclick = null;
    createChoiceQuiz({
      titleText: "ì˜ì–´ ì°¾ê¸°",
      description: "í•œê¸€ ëœ»ì„ ë³´ê³  ì•Œë§ì€ ì˜ì–´ ë‹¨ì–´ë¥¼ ê³¨ë¼ìš”.",
      getQuestionText: (w) => `"${w.kor}" ì— ì•Œë§ì€ ì˜ì–´ ë‹¨ì–´ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?`,
      getBigText: (w) => w.kor,
      getOptionText: (w) => w.eng,
      checkCorrect: (answer, picked) => answer === picked,
      withSound: false
    });
  }

  /************* 4. ë“£ê³  ì°¾ê¸° (ë°œìŒ â†’ ì˜ì–´) *************/
  function renderListenMode() {
    currentMode = "listen";
    document.onkeydown = null;
    soundBtn.onclick = null;
    createChoiceQuiz({
      titleText: "ë“£ê³  ì°¾ê¸°",
      description: "ë°œìŒì„ ë“£ê³  ì•Œë§ì€ ì˜ì–´ ë‹¨ì–´ë¥¼ ê³¨ë¼ìš”.",
      getQuestionText: () => "ì˜ ë“£ê³  ì–´ë–¤ ë‹¨ì–´ì¸ì§€ ë§ì¶° ë³´ì„¸ìš”.",
      getBigText: () => "ğŸ”Š",
      getOptionText: (w) => w.eng,
      checkCorrect: (answer, picked) => answer === picked,
      withSound: true
    });
  }

  /************* 5. ë¬¸ì¥ ë¹ˆì¹¸ *************/
  function renderSentenceMode() {
    currentMode = "sentence";
    document.onkeydown = null;
    soundBtn.onclick = null;
    cardArea.innerHTML = "";

    const wordsWithSentence = WORDS.filter(w => w.ex_en);
    if (!wordsWithSentence.length) {
      cardArea.textContent = "ì˜ˆë¬¸ì´ ìˆëŠ” ë‹¨ì–´ê°€ ì—†ì–´ìš”.";
      return;
    }

    let order = shuffle(wordsWithSentence);
    let idx = 0;
    let score = 0;

    const title = document.createElement("div");
    title.className = "quiz-title";
    title.textContent = "ë¬¸ì¥ì—ì„œ ë¹ˆì¹¸ ë°›ì•„ì“°ê¸°";

    const sub = document.createElement("div");
    sub.className = "quiz-sub";
    sub.textContent = "ë¬¸ì¥ì„ ë³´ê³ , ë¹ˆì¹¸ì— ë“¤ì–´ê°ˆ ì˜ì–´ ë‹¨ì–´ë¥¼ ì¨ ë³´ì„¸ìš”.";

    const sEn = document.createElement("div");
    sEn.className = "sentence-en";

    const sKr = document.createElement("div");
    sKr.className = "sentence-kr";

    const input = document.createElement("input");
    input.type = "text";
    input.className = "blank-input";

    const checkBtn = document.createElement("button");
    checkBtn.className = "btn";
    checkBtn.textContent = "ì •ë‹µ í™•ì¸";

    const feedback = document.createElement("div");
    feedback.className = "feedback";

    const status = document.createElement("div");
    status.className = "status";

    const nextBtn = document.createElement("button");
    nextBtn.className = "btn secondary";
    nextBtn.textContent = "ë‹¤ìŒ ë¬¸ì¥";
    nextBtn.disabled = true;

    const btnRow = document.createElement("div");
    btnRow.className = "btn-row";
    btnRow.appendChild(checkBtn);
    btnRow.appendChild(nextBtn);

    cardArea.appendChild(title);
    cardArea.appendChild(sub);
    cardArea.appendChild(sEn);
    cardArea.appendChild(sKr);
    cardArea.appendChild(input);
    cardArea.appendChild(feedback);
    cardArea.appendChild(status);
    cardArea.appendChild(btnRow);

    function makeBlank(sentence, word) {
      const re = new RegExp(word.eng, "gi");
      return sentence.replace(re, "_____");
    }

    function showSentence() {
      feedback.textContent = "";
      feedback.className = "feedback";
      checkBtn.disabled = false;
      nextBtn.disabled = true;
      input.value = "";
      input.focus();

      if (idx >= order.length) {
        sEn.textContent = "ëª¨ë“  ë¬¸ì¥ì„ ë‹¤ í’€ì—ˆì–´ìš”!";
        sKr.textContent = "";
        input.style.display = "none";
        checkBtn.style.display = "none";
        nextBtn.disabled = false;
        nextBtn.textContent = "ë‹¤ì‹œ í•˜ê¸°";
        status.textContent = `ì´ ${order.length}ë¬¸ì¥ ì¤‘ ${score}ë¬¸ì œë¥¼ ë§í˜”ì–´ìš”.`;

        nextBtn.onclick = () => {
          order = shuffle(wordsWithSentence);
          idx = 0;
          score = 0;
          input.style.display = "inline-block";
          checkBtn.style.display = "inline-block";
          nextBtn.textContent = "ë‹¤ìŒ ë¬¸ì¥";
          showSentence();
        };
        return;
      }

      const w = order[idx];
      sEn.textContent = makeBlank(w.ex_en, w);
      sKr.textContent = w.ex_kr || "";
      status.textContent = `${idx + 1} / ${order.length} ë¬¸ì¥`;

      checkBtn.onclick = () => {
        const user = input.value.trim().toLowerCase();
        if (!user) return;
        const answer = w.eng.toLowerCase();
        if (user === answer) {
          feedback.classList.add("good");
          feedback.textContent = "ì •ë‹µì´ì—ìš”! ğŸ˜Š";
          score++;
        } else {
          feedback.classList.add("bad");
          feedback.textContent = `ì•„ì‰¬ì›Œìš”. ì •ë‹µì€ "${w.eng}"ì˜€ì–´ìš”.`;
        }
        checkBtn.disabled = true;
        nextBtn.disabled = true;
        setTimeout(() => {
          nextBtn.disabled = false;
        }, 300);
      };

      nextBtn.onclick = () => {
        idx++;
        showSentence();
      };
    }

    showSentence();
  }

  /************* ìœ í‹¸: ë°°ì—´ ì„ê¸° *************/
  function shuffle(arr) {
    const a = arr.slice();
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  /************* ëª¨ë“œ ì „í™˜ *************/
  function setMode(mode) {
    document.querySelectorAll(".mode-btn").forEach(btn => {
      btn.classList.toggle("active", btn.dataset.mode === mode);
    });
    if (mode === "vocab")      renderVocabMode();
    else if (mode === "meaning")  renderMeaningMode();
    else if (mode === "english")  renderEnglishMode();
    else if (mode === "listen")   renderListenMode();
    else if (mode === "sentence") renderSentenceMode();
  }

  document.querySelectorAll(".mode-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      setMode(btn.dataset.mode);
    });
  });

  /************* ì‹œì‘: ì—‘ì…€ ë¡œë“œ í›„ ëª¨ë“œ ì‹¤í–‰ *************/
  (async () => {
    try {
      WORDS = await loadWordsForUnit(unitParam);
      if (!WORDS.length) {
        cardArea.textContent = `${unitParam} ìœ ë‹›ì— í•´ë‹¹í•˜ëŠ” ë‹¨ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ì–´ìš”. (ì—‘ì…€ì˜ 'ë²ˆí˜¸' ì—´ì„ í™•ì¸í•´ ì£¼ì„¸ìš”)`;
        return;
      }
      setMode("vocab");
    } catch (e) {
      console.error(e);
      cardArea.textContent = "ë‹¨ì–´ íŒŒì¼(words.xlsx)ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”.";
    }
  })();
</script>
</body>
</html>