<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>1ë‹¨ê³„ ë‹¨ì–´ í•™ìŠµ</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard/dist/web/variable/pretendardvariable.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@500;700&display=swap">

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      font-family: "Pretendard Variable", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f7f8fc;
      color: #111827;
    }
    .page { max-width: 1200px; margin: 32px auto 40px; padding: 0 24px 40px; }

    .top-title-small { font-size: 15px; color: #6b7280; margin-bottom: 4px; }
    .top-title-main { font-size: 32px; font-weight: 800; margin-bottom: 4px; }
    .top-sub { font-size: 15px; color: #6b7280; margin-bottom: 24px; }

    .mode-tabs { display: flex; gap: 12px; margin-bottom: 28px; flex-wrap: wrap; }
    .mode-tab {
      display: flex; align-items: center; gap: 8px;
      padding: 10px 18px; border-radius: 999px;
      background: #e5e7eb; cursor: pointer;
      font-size: 15px; font-weight: 600; color: #111827;
      border: none; transition: 0.2s;
    }
    .mode-tab span.icon { font-size: 18px; }
    .mode-tab.active {
      background: #2563eb; color: #fff;
      box-shadow: 0 10px 25px rgba(37, 99, 235, 0.35);
    }

    .top-right-controls {
      position: absolute; right: 32px; top: 90px;
      display: flex; align-items: center; gap: 8px;
    }
    .btn-ghost {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 8px 16px; border-radius: 999px;
      border: none; background: #e5edff;
      color: #1d4ed8; font-size: 14px; cursor: pointer; font-weight: 600;
    }

    .card-wrapper { position: relative; margin-top: 8px; }
    .card {
      background: #ffffff; border-radius: 32px;
      padding: 52px 72px 44px;
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.14);
      min-height: 330px;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
    }

    .word-big {
      font-family: "Baloo 2", system-ui, sans-serif;
      font-size: 64px; font-weight: 700;
      color: #111827; margin-bottom: 10px;
    }
    .meaning-big {
      font-size: 40px; font-weight: 700;
      color: #374151; margin-bottom: 24px;
    }
    .example-en { font-size: 24px; color: #111827; margin-bottom: 6px; }
    .example-ko { font-size: 20px; color: #4b5563; }

    .quiz-title { font-size: 32px; font-weight: 800; margin-bottom: 8px; text-align: center; }
    .quiz-subtitle { font-size: 16px; color: #6b7280; margin-bottom: 32px; text-align: center; }

    .choices-grid {
      width: 100%; max-width: 900px;
      display: grid; grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 16px;
    }
    .choice {
      padding: 16px 20px; border-radius: 999px;
      border: 2px solid transparent;
      background: #f9fafb; font-size: 17px;
      cursor: pointer; text-align: center; transition: 0.18s;
    }
    .choice:hover { background: #eef2ff; }
    .choice.correct { border-color: #16a34a; background: #dcfce7; }
    .choice.wrong   { border-color: #dc2626; background: #fee2e2; }

    .bottom-bar {
      display: flex; justify-content: space-between; align-items: center;
      margin-top: 32px; width: 100%; max-width: 900px;
    }
    .progress-text { font-size: 14px; color: #6b7280; }
    .nav-buttons { display: flex; gap: 10px; }
    .btn {
      padding: 10px 22px; border-radius: 999px;
      border: none; font-size: 15px; font-weight: 600; cursor: pointer;
    }
    .btn.secondary { background: #e5e7eb; color: #374151; }
    .btn.primary   { background: #2563eb; color: #fff; box-shadow: 0 10px 25px rgba(37,99,235,0.4); }

    .sentence-en { font-size: 30px; font-weight: 800; text-align: center; margin-bottom: 14px; }
    .sentence-ko { font-size: 18px; color: #6b7280; text-align: center; margin-bottom: 24px; }
    .input-row {
      display: flex; justify-content: center; align-items: center;
      gap: 12px; margin-bottom: 18px; flex-wrap: wrap;
    }
    .input-row input {
      min-width: 240px; padding: 12px 18px; border-radius: 999px;
      border: 1px solid #d1d5db; font-size: 18px; text-align: center; outline: none;
    }
    .input-row input:focus {
      border-color: #2563eb; box-shadow: 0 0 0 2px rgba(37,99,235,0.15);
    }
    .hint-text { font-size: 14px; color: #9ca3af; text-align: center; }
    .feedback { font-size: 14px; margin-top: 8px; text-align: center; }
    .feedback.ok  { color: #16a34a; }
    .feedback.bad { color: #dc2626; }

    .result-banner {
      margin-top: 18px; font-size: 16px; font-weight: 600;
      color: #16a34a; text-align: center; display:none;
    }

    @media (max-width: 900px) {
      .card { padding: 36px 20px 34px; border-radius: 24px; }
      .quiz-title { font-size: 26px; }
      .word-big { font-size: 48px; }
      .meaning-big { font-size: 30px; }
      .choices-grid { grid-template-columns: 1fr; }
      .top-right-controls { position: static; margin-bottom: 10px; justify-content: flex-end; }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="top-title-small" id="top-path">1ë‹¨ê³„ Â· 1 ìœ ë‹›</div>
    <div class="top-title-main">1 ë‹¨ì–´ í•™ìŠµ</div>
    <div class="top-sub">ë‹¨ì–´ í•™ìŠµ ëª¨ë“œë¥¼ ì„ íƒí•´ ë³´ì„¸ìš”.</div>

    <div class="mode-tabs">
      <button class="mode-tab active" data-mode="study"><span class="icon">ğŸ“š</span><span>ì–´íœ˜ í•™ìŠµ</span></button>
      <button class="mode-tab" data-mode="meaning"><span class="icon">âœ…</span><span>ëœ» ì°¾ê¸°</span></button>
      <button class="mode-tab" data-mode="english"><span class="icon">ğŸ”¤</span><span>ì˜ì–´ ì°¾ê¸°</span></button>
      <button class="mode-tab" data-mode="listen"><span class="icon">ğŸ§</span><span>ë“£ê³  ì°¾ê¸°</span></button>
      <button class="mode-tab" data-mode="sentence"><span class="icon">âœï¸</span><span>ë¬¸ì¥ ë¹ˆì¹¸</span></button>
    </div>

    <div class="top-right-controls">
      <button class="btn-ghost" id="btnReplay"><span>ğŸ”Š</span><span>ë‹¤ì‹œ ë“£ê¸°</span></button>
    </div>

    <div class="card-wrapper">
      <div class="card">
        <!-- ì–´íœ˜ í•™ìŠµ -->
        <div id="view-study">
          <div class="word-big" id="study-word">at</div>
          <div class="meaning-big" id="study-meaning">~ì—</div>
          <div class="example-en" id="study-example-en">at 7 o'clock</div>
          <div class="example-ko" id="study-example-ko">7ì‹œ ì •ê°ì—</div>
        </div>

        <!-- ëœ» ì°¾ê¸° -->
        <div id="view-meaning" style="display:none;">
          <div class="quiz-title" id="meaning-word">at</div>
          <div class="quiz-subtitle">ì˜ì–´ë¥¼ ë³´ê³  ì•Œë§ì€ í•œê¸€ ëœ»ì„ ê³¨ë¼ìš”.</div>
          <div class="choices-grid" id="meaning-choices"></div>
        </div>

        <!-- ì˜ì–´ ì°¾ê¸° -->
        <div id="view-english" style="display:none;">
          <div class="quiz-title" id="english-meaning">~ì—</div>
          <div class="quiz-subtitle">í•œê¸€ ëœ»ì„ ë³´ê³  ì•Œë§ì€ ì˜ì–´ë¥¼ ê³¨ë¼ìš”.</div>
          <div class="choices-grid" id="english-choices"></div>
        </div>

        <!-- ë“£ê³  ì°¾ê¸° -->
        <div id="view-listen" style="display:none;">
          <div class="quiz-title">ë°œìŒì„ ë“£ê³  ì–´ë–¤ ë‹¨ì–´ì¸ì§€ ë§í˜€ ë³´ì•„ìš”.</div>
          <div class="quiz-subtitle">ìœ„ì— ìˆëŠ” <b>ë‹¤ì‹œ ë“£ê¸°</b> ë²„íŠ¼ì„ ëˆŒëŸ¬ë„ ë¼ìš”.</div>
          <div class="choices-grid" id="listen-choices"></div>
        </div>

        <!-- ë¬¸ì¥ ë¹ˆì¹¸ -->
        <div id="view-sentence" style="display:none;">
          <div class="sentence-en" id="sentence-en">I get up ____ 7 o'clock.</div>
          <div class="sentence-ko" id="sentence-ko">ë‚˜ëŠ” 7ì‹œ ì •ê°ì— ì¼ì–´ë‚˜.</div>
          <div class="input-row">
            <input id="sentence-input" type="text" placeholder="ì •ë‹µ ë‹¨ì–´ë¥¼ ì¨ ë³´ì„¸ìš”" autocomplete="off" />
            <button class="btn secondary" id="btnCheck">í™•ì¸</button>
          </div>
          <div class="hint-text">ì •ë‹µì„ ì“°ê³  Enter ë˜ëŠ” ìŠ¤í˜ì´ìŠ¤ë¥¼ ëˆŒëŸ¬ë„ ë¼ìš”.</div>
          <div class="feedback" id="sentence-feedback"></div>
        </div>

        <div class="result-banner" id="result-banner"></div>

        <div class="bottom-bar">
          <div class="progress-text" id="progressText">1 / 10</div>
          <div class="nav-buttons">
            <button class="btn secondary" id="btnPrev">ì´ì „</button>
            <button class="btn primary" id="btnNext">ë‹¤ìŒ</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ---------------- ë°ì´í„° ë¡œë”© (words.json) ---------------- */

    let ALL_WORDS = [];   // ì „ì²´ ë‹¨ì–´
    let WORDS = [];       // í˜„ì¬ ìœ ë‹› ë‹¨ì–´
    let TOTAL = 0;

    async function loadWordsJson() {
      const res = await fetch("words.json");
      ALL_WORDS = await res.json();
    }

    /* ---------------- ê³µí†µ ìƒíƒœ ---------------- */

    let mode = "study";
    let remaining = [];
    let currentIdx = 0;
    let solvedCount = 0;

    const viewStudy     = document.getElementById("view-study");
    const viewMeaning   = document.getElementById("view-meaning");
    const viewEnglish   = document.getElementById("view-english");
    const viewListen    = document.getElementById("view-listen");
    const viewSentence  = document.getElementById("view-sentence");
    const resultBanner  = document.getElementById("result-banner");
    const progressText  = document.getElementById("progressText");
    const btnPrev       = document.getElementById("btnPrev");
    const btnNext       = document.getElementById("btnNext");
    const btnReplay     = document.getElementById("btnReplay");
    const sentenceInput = document.getElementById("sentence-input");
    const sentenceFeedback = document.getElementById("sentence-feedback");
    const btnCheck      = document.getElementById("btnCheck");

    function shuffle(arr) {
      const a = arr.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function speak(text) {
      if (!window.speechSynthesis) return;
      const u = new SpeechSynthesisUtterance(text);
      u.lang = "en-US";
      u.rate = 0.9;
      speechSynthesis.speak(u);
    }
    function speakTwice(text) {
      if (!window.speechSynthesis) return;
      speechSynthesis.cancel();
      const u1 = new SpeechSynthesisUtterance(text);
      const u2 = new SpeechSynthesisUtterance(text);
      u1.lang = u2.lang = "en-US";
      u1.rate = u2.rate = 0.9;
      speechSynthesis.speak(u1);
      speechSynthesis.speak(u2);
    }

    function updateProgress() {
      progressText.innerText = `${Math.min(solvedCount + 1, TOTAL)} / ${TOTAL}`;
    }

    function showResultIfDone() {
      if (remaining.length === 0) {
        resultBanner.style.display = "block";
        resultBanner.innerText = "ëª¨ë“  ë¬¸ì œë¥¼ ë‹¤ ë§ì·„ì–´ìš”! ì ìˆ˜ëŠ” 100ì  ğŸ‰";
      } else {
        resultBanner.style.display = "none";
      }
    }

    function goNext() {
      if (remaining.length === 0) return;
      solvedCount = Math.min(solvedCount + 1, TOTAL - 1);
      currentIdx = remaining[0];
      renderCurrent();
    }
    function goPrev() {
      if (solvedCount <= 0) return;
      solvedCount -= 1;
      currentIdx = remaining[0];
      renderCurrent();
    }

    /* ---------------- ëª¨ë“œ ì „í™˜ ---------------- */

    const modeTabs = document.querySelectorAll(".mode-tab");
    modeTabs.forEach(tab => {
      tab.addEventListener("click", () => {
        const newMode = tab.getAttribute("data-mode");
        if (mode === newMode) return;
        mode = newMode;
        modeTabs.forEach(t => t.classList.toggle("active", t === tab));
        resetForMode();
      });
    });

    function resetForMode() {
      remaining  = WORDS.map((_, i) => i);
      currentIdx = remaining[0];
      solvedCount = 0;

      viewStudy.style.display    = (mode === "study")    ? "block" : "none";
      viewMeaning.style.display  = (mode === "meaning")  ? "block" : "none";
      viewEnglish.style.display  = (mode === "english")  ? "block" : "none";
      viewListen.style.display   = (mode === "listen")   ? "block" : "none";
      viewSentence.style.display = (mode === "sentence") ? "block" : "none";

      sentenceFeedback.innerText = "";
      sentenceInput.value = "";

      renderCurrent();
      showResultIfDone();
    }

    /* ---------------- ê° ëª¨ë“œ ë Œë”ë§ ---------------- */

    function renderStudy() {
      const w = WORDS[currentIdx];
      document.getElementById("study-word").innerText = w.en;
      document.getElementById("study-meaning").innerText = w.ko;
      document.getElementById("study-example-en").innerText = w.exEn;
      document.getElementById("study-example-ko").innerText = w.exKo;
      speakTwice(w.en);
    }

    function renderMeaning() {
      const w = WORDS[currentIdx];
      document.getElementById("meaning-word").innerText = w.en;

      const box = document.getElementById("meaning-choices");
      box.innerHTML = "";
      const others = WORDS.filter((_, i) => i !== currentIdx);
      const wrongs = shuffle(others).slice(0, Math.min(3, others.length));
      const options = shuffle([w, ...wrongs]);

      options.forEach(opt => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "choice";
        btn.innerText = opt.ko;
        btn.addEventListener("click", () => handleChoice(btn, opt.ko === w.ko));
        box.appendChild(btn);
      });
      speakTwice(w.en);
    }

    function renderEnglish() {
      const w = WORDS[currentIdx];
      document.getElementById("english-meaning").innerText = w.ko;

      const box = document.getElementById("english-choices");
      box.innerHTML = "";
      const others = WORDS.filter((_, i) => i !== currentIdx);
      const wrongs = shuffle(others).slice(0, Math.min(3, others.length));
      const options = shuffle([w, ...wrongs]);

      options.forEach(opt => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "choice";
        btn.innerText = opt.en;
        btn.addEventListener("click", () => handleChoice(btn, opt.en === w.en));
        box.appendChild(btn);
      });
      speakTwice(w.en);
    }

    function renderListen() {
      const w = WORDS[currentIdx];

      const box = document.getElementById("listen-choices");
      box.innerHTML = "";
      const others = WORDS.filter((_, i) => i !== currentIdx);
      const wrongs = shuffle(others).slice(0, Math.min(3, others.length));
      const options = shuffle([w, ...wrongs]);

      options.forEach(opt => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "choice";
        btn.innerText = opt.en;
        btn.addEventListener("click", () => handleChoice(btn, opt.en === w.en));
        box.appendChild(btn);
      });
      speakTwice(w.en);
    }

    function renderSentence() {
      const w = WORDS[currentIdx];
      const target = w.en;
      const regex = new RegExp("\\b" + target + "\\b", "i");
      const blankSentence = w.exEn.replace(regex, "____");

      document.getElementById("sentence-en").innerText = blankSentence;
      document.getElementById("sentence-ko").innerText = w.exKo;
      sentenceInput.value = "";
      sentenceFeedback.innerText = "";
      sentenceInput.focus();
      speakTwice(w.exEn);
    }

    function handleChoice(btn, isCorrect) {
      const parent = btn.parentElement;
      parent.querySelectorAll(".choice").forEach(c => c.disabled = true);

      if (isCorrect) {
        btn.classList.add("correct");
        handleAnswer(true);
      } else {
        btn.classList.add("wrong");
        handleAnswer(false);
      }
    }

    function handleAnswer(isCorrect) {
      const idx = remaining[0];
      remaining.shift();
      if (!isCorrect) remaining.push(idx);

      showResultIfDone();

      if (remaining.length > 0) {
        currentIdx = remaining[0];
        if (solvedCount < TOTAL - 1) solvedCount++;
        setTimeout(renderCurrent, 500);
      }
    }

    function renderCurrent() {
      if (TOTAL === 0) return;
      updateProgress();
      if      (mode === "study")    renderStudy();
      else if (mode === "meaning")  renderMeaning();
      else if (mode === "english")  renderEnglish();
      else if (mode === "listen")   renderListen();
      else if (mode === "sentence") renderSentence();
    }

    /* ---------------- ë²„íŠ¼ ì´ë²¤íŠ¸ ---------------- */

    btnNext.addEventListener("click", () => {
      if (mode === "sentence") {
        checkSentence();
      } else {
        goNext();
      }
    });
    btnPrev.addEventListener("click", goPrev);

    btnReplay.addEventListener("click", () => {
      const w = WORDS[currentIdx];
      if (!w) return;
      if (mode === "sentence") speakTwice(w.exEn);
      else speakTwice(w.en);
    });

    function checkSentence() {
      const w = WORDS[currentIdx];
      if (!w) return;
      const answer = w.en.toLowerCase().trim();
      const user   = sentenceInput.value.toLowerCase().trim();
      if (!user) return;

      if (user === answer) {
        sentenceFeedback.innerText = "ì •ë‹µì´ì—ìš”! ì˜í–ˆì–´ìš” ğŸ‘";
        sentenceFeedback.className = "feedback ok";
        handleAnswer(true);
      } else {
        sentenceFeedback.innerText = "ì•„ì‰¬ì›Œìš” ğŸ˜¢  ë‹¤ì‹œ í•œ ë²ˆ ì¨ ë³¼ê¹Œìš”?";
        sentenceFeedback.className = "feedback bad";
        handleAnswer(false);
      }
    }

    btnCheck.addEventListener("click", checkSentence);
    sentenceInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " " || e.code === "Space") {
        e.preventDefault();
        checkSentence();
      }
    });

    /* ---------------- ì´ˆê¸° ì‹œì‘ ---------------- */

    (async function init() {
      // 1) ë‹¨ì–´ JSON ë¡œë“œ
      await loadWordsJson();

      // 2) URLì—ì„œ ë‹¨ê³„/ìœ ë‹› ì½ê¸°
      const params = new URLSearchParams(window.location.search);
      const stage = params.get("stage") || "1";
      const unit  = params.get("unit")  || "1";
      const unitKey = `${stage}-${unit}`;
      document.getElementById("top-path").innerText = `${stage}ë‹¨ê³„ Â· ${unit} ìœ ë‹›`;

      // 3) í˜„ì¬ ìœ ë‹› ë‹¨ì–´ í•„í„°
      WORDS = ALL_WORDS.filter(w => w.unit === unitKey);
      TOTAL = WORDS.length;

      if (TOTAL === 0) {
        resultBanner.style.display = "block";
        resultBanner.innerText = `${unitKey} ìœ ë‹›ì— ë“±ë¡ëœ ë‹¨ì–´ê°€ ì—†ì–´ìš”.`;
        return;
      }
      resetForMode();
    })();
  </script>
</body>
</html>