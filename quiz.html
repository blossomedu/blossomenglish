<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Blossom English - QUIZ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/pretendard/dist/web/variable/pretendardvariable.css" rel="stylesheet" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Pretendard Variable", -apple-system, BlinkMacSystemFont,
        system-ui, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
    }

    body {
      background: #f4f6fb;
      color: #111827;
      min-height: 100vh;
    }

    .page {
      max-width: 1100px;
      margin: 0 auto;
      padding: 32px 16px 48px;
    }

    h1.main-title {
      font-size: 28px;
      font-weight: 800;
      margin-bottom: 24px;
    }

    .top-bar {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }

    .mode-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .mode-tab {
      padding: 10px 18px;
      border-radius: 999px;
      border: none;
      background: #e5e7ff;
      color: #111827;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: all 0.15s ease;
      white-space: nowrap;
    }

    .mode-tab.active {
      background: #2563eb;
      color: #ffffff;
      box-shadow: 0 12px 25px rgba(37, 99, 235, 0.35);
    }

    .card {
      background: #ffffff;
      border-radius: 28px;
      padding: 32px 24px 28px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.08);
      min-height: 360px;
      position: relative;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .center-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      gap: 14px;
      padding: 10px 8px;
    }

    .word-big {
      font-size: 64px;
      font-weight: 800;
      color: #b91c1c;
    }

    .meaning-big {
      font-size: 36px;
      font-weight: 700;
      color: #111827;
    }

    .example-en {
      font-size: 18px;
      color: #4b5563;
      margin-top: 18px;
    }

    .example-ko {
      font-size: 16px;
      color: #6b7280;
    }

    .question-title {
      font-size: 28px;
      font-weight: 800;
      margin-bottom: 12px;
    }

    .question-sub {
      font-size: 16px;
      color: #6b7280;
      margin-bottom: 14px;
    }

    .choices-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px 22px;
      width: 100%;
      max-width: 620px;
    }

    .choice-btn {
      width: 100%;
      min-height: 58px;
      padding: 14px 16px;
      border-radius: 18px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      font-size: 16px;
      cursor: pointer;
      transition: 0.15s ease;
    }

    .choice-btn:hover {
      background: #eef2ff;
    }

    .choice-btn.correct {
      background: #dcfce7;
      border-color: #22c55e;
      color: #166534;
      font-weight: 600;
    }

    .choice-btn.wrong {
      background: #fee2e2;
      border-color: #f97373;
      color: #b91c1c;
    }

    .sentence-en {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .sentence-ko {
      font-size: 18px;
      color: #4b5563;
      margin-bottom: 12px;
    }

    .sentence-row {
      display: flex;
      gap: 10px;
      margin-top: 8px;
      width: 100%;
      max-width: 520px;
    }

    .sentence-input {
      flex: 1;
      padding: 12px 16px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      font-size: 16px;
    }

    .check-btn {
      padding: 11px 18px;
      border-radius: 999px;
      background: #e5edff;
      border: none;
      color: #1d4ed8;
      font-size: 14px;
      cursor: pointer;
      white-space: nowrap;
    }

    .hint-text {
      margin-top: 8px;
      font-size: 14px;
      color: #6b21a8;
    }

    .result-text {
      margin-top: 10px;
      font-size: 16px;
      font-weight: 600;
    }

    .bottom-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 20px;
      gap: 10px;
      flex-wrap: wrap;
    }

    #progressText {
      font-size: 14px;
      color: #6b7280;
    }

    .bottom-buttons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .nav-btn {
      padding: 9px 18px;
      border-radius: 999px;
      border: none;
      font-size: 14px;
      cursor: pointer;
      white-space: nowrap;
    }

    .nav-btn.back {
      background: #e5e7eb;
      color: #374151;
    }

    .nav-btn.reset-mode {
      background: #fee2e2;
      color: #b91c1c;
    }

    .score-banner {
      font-size: 20px;
      font-weight: 800;
      color: #16a34a;
      margin-top: 8px;
    }

    .info-text {
      font-size: 14px;
      color: #6b7280;
      margin-top: 4px;
    }

    @media (max-width: 700px) {
      .card {
        padding: 24px 16px 22px;
      }
      .word-big {
        font-size: 48px;
      }
      .meaning-big {
        font-size: 28px;
      }
      .question-title {
        font-size: 24px;
      }
      .choices-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
<div class="page">
  <h1 class="main-title" id="mainTitle">ë‹¨ì–´ í•™ìŠµ 1-1</h1>

  <div class="top-bar">
    <div class="mode-tabs">
      <button class="mode-tab active" data-mode="study">ğŸ“š ì–´íœ˜ í•™ìŠµ</button>
      <button class="mode-tab" data-mode="meaning">âœ… ëœ» ì°¾ê¸°</button>
      <button class="mode-tab" data-mode="english">ğŸ”¤ ì˜ì–´ ì°¾ê¸°</button>
      <button class="mode-tab" data-mode="listening">ğŸ§ ë“£ê³  ì°¾ê¸°</button>
      <button class="mode-tab" data-mode="sentence">âœï¸ ë¬¸ì¥ ë¹ˆì¹¸</button>
    </div>
  </div>

  <div class="card">
    <div class="center-area" id="centerArea"></div>

    <div class="bottom-bar">
      <div>
        <div id="progressText">-</div>
        <div id="modeInfo" class="info-text"></div>
      </div>
      <div class="bottom-buttons">
        <button class="nav-btn reset-mode" id="resetModeBtn">ì´ ëª¨ë“œ ë‹¤ì‹œ ì‹œì‘</button>
        <button class="nav-btn back" id="backBtn">ìœ ë‹›ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
      </div>
    </div>
  </div>
</div>

<script>
/* -------------------------------
   0. URL íŒŒë¼ë¯¸í„° & ë‹¨ì–´ ë°ì´í„°
-------------------------------- */
const params = new URLSearchParams(window.location.search);
const stage = params.get("stage") || "1";
let unitParam = params.get("unit") || "1-1";
/* ìˆ«ìë§Œ ë“¤ì–´ì˜¤ë©´ 1 â†’ 1-1 ì²˜ë¦¬ */
if (/^\\d+$/.test(unitParam)) {
  unitParam = unitParam + "-1";
}

/* ì—‘ì…€ 1-1 ë‹¨ì–´ 10ê°œ */
const WORD_SETS = {
  "1-1": [
    { word: "at",   meaning: "~ì—",             exampleEn: "at 7 o'clock",      exampleKo: "7ì‹œ ì •ê°ì—" },
    { word: "bat",  meaning: "ì•¼êµ¬ë°©ë§ì´, ë°•ì¥", exampleEn: "I have a bat.",     exampleKo: "ë‚˜ëŠ” ì•¼êµ¬ ë°©ë§ì´ë¥¼ ê°€ì§€ê³  ìˆì–´." },
    { word: "fat",  meaning: "ëš±ëš±í•œ, ì‚´ì°",     exampleEn: "a fat cat",         exampleKo: "ëš±ëš±í•œ ê³ ì–‘ì´" },
    { word: "hat",  meaning: "ëª¨ì",             exampleEn: "a yellow hat",      exampleKo: "ë…¸ë€ìƒ‰ ëª¨ì" },
    { word: "chat", meaning: "ì´ì•¼ê¸°í•˜ë‹¤, ìˆ˜ë‹¤ ë–¨ë‹¤", exampleEn: "I like to chat.", exampleKo: "ë‚˜ëŠ” ì´ì•¼ê¸°í•˜ëŠ” ê²ƒì„ ì¢‹ì•„í•´." },
    { word: "act",  meaning: "í–‰ë™í•˜ë‹¤, ì—°ê¸°í•˜ë‹¤", exampleEn: "act like a kid",   exampleKo: "ì•„ì´ì²˜ëŸ¼ í–‰ë™í•˜ë‹¤" },
    { word: "fact", meaning: "ì‚¬ì‹¤",             exampleEn: "a clear fact",      exampleKo: "ë¶„ëª…í•œ ì‚¬ì‹¤" },
    { word: "fan",  meaning: "íŒ¬, ì„ í’ê¸°",       exampleEn: "a big fan",         exampleKo: "í° ì„ í’ê¸°" },
    { word: "man",  meaning: "ë‚¨ì, ì‚¬ëŒ",       exampleEn: "an old man",        exampleKo: "ë‚˜ì´ ë“  ë‚¨ì" },
    { word: "pants",meaning: "ë°”ì§€",             exampleEn: "blue pants",        exampleKo: "íŒŒë€ìƒ‰ ë°”ì§€" }
  ]
};

const unitKey = unitParam;
const words = WORD_SETS[unitKey] || [];
const wordCount = words.length;

const mainTitle = document.getElementById("mainTitle");
mainTitle.textContent = `ë‹¨ì–´ í•™ìŠµ ${unitKey}`;

const centerArea = document.getElementById("centerArea");
const progressText = document.getElementById("progressText");
const modeInfo = document.getElementById("modeInfo");
const modeTabs = document.querySelectorAll(".mode-tab");
const resetModeBtn = document.getElementById("resetModeBtn");
const backBtn = document.getElementById("backBtn");

/* ìœ ë‹›ìœ¼ë¡œ ëŒì•„ê°€ê¸°: units-detail.html?stage=1 */
backBtn.onclick = () => {
  window.location.href = `units-detail.html?stage=${stage}`;
};

/* -------------------------------
   1. ìŒì„± í•©ì„± (ì—¬ì ìŒì„± ì„ íƒ)
-------------------------------- */
let selectedVoice = null;

function initVoice() {
  if (!("speechSynthesis" in window)) return;
  const synth = window.speechSynthesis;
  const voices = synth.getVoices();
  if (!voices || voices.length === 0) {
    synth.onvoiceschanged = () => {
      synth.onvoiceschanged = null;
      initVoice();
    };
    return;
  }
  // female / en ìš°ì„ 
  selectedVoice =
    voices.find(v => v.lang.startsWith("en") && /female|woman/i.test(v.name)) ||
    voices.find(v => v.lang === "en-US") ||
    voices.find(v => v.lang.startsWith("en")) ||
    voices[0];
}

initVoice();

/* 1ì´ˆ ê°„ê²©ìœ¼ë¡œ 2ë²ˆ ì½ê³ , ëë‚˜ë©´ ì½œë°± í˜¸ì¶œ */
function speakWordTwice(word, onDone) {
  if (!("speechSynthesis" in window)) {
    if (typeof onDone === "function") onDone();
    return;
  }
  const synth = window.speechSynthesis;
  synth.cancel();

  const u1 = new SpeechSynthesisUtterance(word);
  const u2 = new SpeechSynthesisUtterance(word);
  u1.lang = "en-US";
  u2.lang = "en-US";
  if (selectedVoice) {
    u1.voice = selectedVoice;
    u2.voice = selectedVoice;
  }

  u1.onend = () => {
    setTimeout(() => synth.speak(u2), 1000); // 1ì´ˆ ê°„ê²©
  };
  u2.onend = () => {
    if (typeof onDone === "function") onDone();
  };

  synth.speak(u1);
}

function stopSpeech() {
  if ("speechSynthesis" in window) {
    window.speechSynthesis.cancel();
  }
}

/* -------------------------------
   2. ê³µí†µ ìœ í‹¸
-------------------------------- */
let currentMode = "study";
let currentTimerId = null;

function clearTimer() {
  if (currentTimerId !== null) {
    clearTimeout(currentTimerId);
    currentTimerId = null;
  }
}

function shuffle(arr) {
  const a = arr.slice();
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function updateProgress(current, total) {
  progressText.textContent = `${current} / ${total}`;
}

function setModeInfo(text) {
  modeInfo.textContent = text || "";
}

/* -------------------------------
   3. ì–´íœ˜ í•™ìŠµ ëª¨ë“œ (ìë™ ì§„í–‰)
-------------------------------- */
let studyIndex = 0;

function startStudyMode() {
  clearTimer();
  stopSpeech();
  studyIndex = 0;
  renderStudyWord();
  setModeInfo("ë‹¨ì–´ì™€ ì˜ˆë¬¸ì„ ë³´ê³  ë“£ê³ , ìë™ìœ¼ë¡œ ë‹¤ìŒ ë‹¨ì–´ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.");
}

function renderStudyWord() {
  clearTimer();
  stopSpeech();
  if (studyIndex >= wordCount) {
    centerArea.innerHTML = `
      <div class="score-banner">ì´ ìœ ë‹›ì˜ ì–´íœ˜ í•™ìŠµì´ ëë‚¬ì–´ìš”!</div>
      <div class="info-text">ë‹¤ë¥¸ ëª¨ë“œ(ëœ» ì°¾ê¸°, ì˜ì–´ ì°¾ê¸°, ë“£ê³  ì°¾ê¸°, ë¬¸ì¥ ë¹ˆì¹¸)ë¡œ ì—°ìŠµí•´ë³´ì„¸ìš”.</div>
    `;
    updateProgress(wordCount, wordCount);
    return;
  }
  const item = words[studyIndex];
  centerArea.innerHTML = `
    <div class="word-big">${item.word}</div>
    <div class="meaning-big">${item.meaning}</div>
    <div class="example-en">${item.exampleEn}</div>
    <div class="example-ko">${item.exampleKo}</div>
  `;
  updateProgress(studyIndex + 1, wordCount);

  const indexForThisRound = studyIndex;
  speakWordTwice(item.word, () => {
    // ì•„ì§ study ëª¨ë“œì´ê³ , ê·¸ ì‚¬ì´ì— ì¸ë±ìŠ¤ê°€ ì•ˆ ë°”ë€Œì—ˆì„ ë•Œë§Œ ìë™ ì§„í–‰
    if (currentMode === "study" && indexForThisRound === studyIndex) {
      studyIndex++;
      renderStudyWord();
    }
  });
}

/* -------------------------------
   4. 4ì§€ì„ ë‹¤ ê³µí†µ(ëœ»/ì˜ì–´/ë“£ê¸°)
-------------------------------- */
const choiceModeState = {
  mode: null,           // "meaning" | "english" | "listening"
  order: [],
  indexInOrder: 0,
  mistakes: []
};

function initChoiceMode(mode) {
  clearTimer();
  stopSpeech();
  choiceModeState.mode = mode;
  choiceModeState.order = [...Array(wordCount).keys()];
  choiceModeState.indexInOrder = 0;
  choiceModeState.mistakes = [];
  if (mode === "meaning") {
    setModeInfo("ì˜ì–´ ë‹¨ì–´ë¥¼ ë³´ê³  ì•Œë§ì€ í•œê¸€ ëœ»ì„ 7ì´ˆ ì•ˆì— ê³¨ë¼ë³´ì„¸ìš”.");
  } else if (mode === "english") {
    setModeInfo("í•œê¸€ ëœ»ì„ ë³´ê³  ì•Œë§ì€ ì˜ì–´ ë‹¨ì–´ë¥¼ 7ì´ˆ ì•ˆì— ê³¨ë¼ë³´ì„¸ìš”.");
  } else if (mode === "listening") {
    setModeInfo("ë°œìŒì„ ë‘ ë²ˆ ë“£ê³ , ì•Œë§ì€ í•œê¸€ ëœ»ì„ 7ì´ˆ ì•ˆì— ê³¨ë¼ë³´ì„¸ìš”.");
  }
  renderChoiceQuestion();
}

function nextChoiceQuestionOrLoop() {
  choiceModeState.indexInOrder++;
  if (choiceModeState.indexInOrder >= choiceModeState.order.length) {
    // í•œ ë¼ìš´ë“œ ë
    if (choiceModeState.mistakes.length > 0) {
      const uniqueMistakes = Array.from(new Set(choiceModeState.mistakes));
      choiceModeState.order = uniqueMistakes;
      choiceModeState.indexInOrder = 0;
      choiceModeState.mistakes = [];
      renderChoiceQuestion();
    } else {
      // ëª¨ë‘ í•œ ë²ˆì”©ì€ ë§í˜ â†’ 100ì 
      centerArea.innerHTML = `
        <div class="score-banner">ì¶•í•˜í•©ë‹ˆë‹¤! 100ì  ğŸ‰</div>
        <div class="info-text">ì´ ëª¨ë“œëŠ” ëª¨ë‘ ë§í˜”ì–´ìš”. ë‹¤ë¥¸ ëª¨ë“œë„ ë„ì „í•´ ë³´ì„¸ìš”.</div>
      `;
      updateProgress(choiceModeState.order.length, wordCount);
    }
  } else {
    renderChoiceQuestion();
  }
}

function renderChoiceQuestion() {
  clearTimer();
  stopSpeech();
  if (choiceModeState.indexInOrder >= choiceModeState.order.length) {
    // ì•ˆì „ì¥ì¹˜
    nextChoiceQuestionOrLoop();
    return;
  }

  const wordIndex = choiceModeState.order[choiceModeState.indexInOrder];
  const item = words[wordIndex];

  // ë¬¸ì œ ì œëª© & ì„¤ëª…
  let title, sub;
  if (choiceModeState.mode === "meaning") {
    title = item.word;
    sub = "ì˜ì–´ë¥¼ ë³´ê³  ì•Œë§ì€ í•œê¸€ ëœ»ì„ ê³¨ë¼ìš”.";
  } else if (choiceModeState.mode === "english") {
    title = item.meaning;
    sub = "í•œê¸€ ëœ»ì„ ë³´ê³  ì•Œë§ì€ ì˜ì–´ ë‹¨ì–´ë¥¼ ê³¨ë¼ìš”.";
  } else { // listening
    title = "ë°œìŒì„ ë“£ê³  ì•Œë§ì€ ëœ»ì„ ê³¨ë¼ìš”.";
    sub = "";
  }

  centerArea.innerHTML = `
    <div class="question-title">${title}</div>
    <div class="question-sub">${sub}</div>
  `;
  const grid = document.createElement("div");
  grid.className = "choices-grid";
  centerArea.appendChild(grid);

  // ë³´ê¸° 4ê°œ ì¸ë±ìŠ¤ ë§Œë“¤ê¸°
  const others = [...Array(wordCount).keys()].filter(i => i !== wordIndex);
  const allChoices = shuffle([wordIndex, ...shuffle(others).slice(0, 3)]);

  let answered = false;

  function markAnswer(chosenIndex, isTimeout = false) {
    if (answered) return;
    answered = true;
    clearTimer();

    const buttons = grid.querySelectorAll(".choice-btn");
    buttons.forEach(btn => {
      const idx = Number(btn.dataset.idx);
      if (idx === wordIndex) {
        btn.classList.add("correct");
      }
      if (!isTimeout && idx === chosenIndex && idx !== wordIndex) {
        btn.classList.add("wrong");
      }
      if (isTimeout && idx === wordIndex) {
        // ì‹œê°„ì´ˆê³¼ì—ì„œ ì •ë‹µë§Œ ë…¹ìƒ‰ ê°•ì¡°
        btn.classList.add("correct");
      }
      btn.disabled = true;
    });

    if (chosenIndex !== wordIndex || isTimeout) {
      choiceModeState.mistakes.push(wordIndex);
      const message = isTimeout
        ? `ì‹œê°„ ì´ˆê³¼! ì •ë‹µì€ "${formatCorrectText(wordIndex)}" ì…ë‹ˆë‹¤.`
        : `í‹€ë ¸ì–´ìš”! ì •ë‹µì€ "${formatCorrectText(wordIndex)}" ì…ë‹ˆë‹¤.`;
      const result = document.createElement("div");
      result.className = "result-text";
      result.textContent = message;
      centerArea.appendChild(result);
    } else {
      const result = document.createElement("div");
      result.className = "result-text";
      result.textContent = "ì •ë‹µì´ì—ìš”! ğŸ‘";
      centerArea.appendChild(result);
    }

    setTimeout(() => {
      if (currentMode === choiceModeState.mode) {
        nextChoiceQuestionOrLoop();
      }
    }, 1200);
  }

  // ë²„íŠ¼ ìƒì„±
  allChoices.forEach(idx => {
    const ch = words[idx];
    const btn = document.createElement("button");
    btn.className = "choice-btn";
    btn.dataset.idx = String(idx);

    if (choiceModeState.mode === "meaning" || choiceModeState.mode === "listening") {
      btn.textContent = ch.meaning;
    } else if (choiceModeState.mode === "english") {
      btn.textContent = ch.word;
    }

    btn.onclick = () => {
      if (!answered) {
        markAnswer(idx, false);
      }
    };

    grid.appendChild(btn);
  });

  updateProgress(choiceModeState.indexInOrder + 1, wordCount);

  // ë“£ê³  ì°¾ê¸° ëª¨ë“œëŠ” ë°œìŒ 2ë²ˆ ì¬ìƒ
  if (choiceModeState.mode === "listening") {
    speakWordTwice(item.word, () => {});
  }

  // 7ì´ˆ íƒ€ì´ë¨¸: ë¯¸ì„ íƒ â†’ ì˜¤ë‹µ ì²˜ë¦¬
  currentTimerId = setTimeout(() => {
    if (!answered) {
      markAnswer(null, true);
    }
  }, 7000);
}

function formatCorrectText(index) {
  const item = words[index];
  if (choiceModeState.mode === "meaning" || choiceModeState.mode === "listening") {
    return `${item.meaning}`;
  } else if (choiceModeState.mode === "english") {
    return `${item.word}`;
  }
  return "";
}

/* -------------------------------
   5. ë¬¸ì¥ ë¹ˆì¹¸ ëª¨ë“œ
-------------------------------- */
const sentenceState = {
  order: [],
  indexInOrder: 0
};

function startSentenceMode() {
  clearTimer();
  stopSpeech();
  sentenceState.order = [...Array(wordCount).keys()];
  sentenceState.indexInOrder = 0;
  setModeInfo("ì˜ˆë¬¸ ì† ë¹ˆì¹¸ì— ë“¤ì–´ê°ˆ ë‹¨ì–´ë¥¼ ì§ì ‘ ì¨ ë³´ì„¸ìš”. ì‹œê°„ ì œí•œì€ ì—†ì–´ìš”.");
  renderSentenceQuestion();
}

function nextSentenceQuestion() {
  sentenceState.indexInOrder++;
  if (sentenceState.indexInOrder >= sentenceState.order.length) {
    centerArea.innerHTML = `
      <div class="score-banner">ì¶•í•˜í•©ë‹ˆë‹¤! 100ì  ğŸ‰</div>
      <div class="info-text">ì´ ìœ ë‹›ì˜ ë¬¸ì¥ ë¹ˆì¹¸ ì—°ìŠµì„ ëª¨ë‘ ì™„ë£Œí–ˆì–´ìš”.</div>
    `;
    updateProgress(sentenceState.order.length, wordCount);
  } else {
    renderSentenceQuestion();
  }
}

function renderSentenceQuestion() {
  clearTimer();
  stopSpeech();
  const wordIndex = sentenceState.order[sentenceState.indexInOrder];
  const item = words[wordIndex];

  const blanked = item.exampleEn.replace(new RegExp(item.word, "i"), "____");

  centerArea.innerHTML = `
    <div class="sentence-en">${blanked}</div>
    <div class="sentence-ko">${item.exampleKo}</div>
  `;

  const row = document.createElement("div");
  row.className = "sentence-row";

  const input = document.createElement("input");
  input.className = "sentence-input";
  input.placeholder = "ì—¬ê¸°ì— ì˜ì–´ ë‹¨ì–´ë¥¼ ì¨ ë³´ì„¸ìš”";

  const checkBtn = document.createElement("button");
  checkBtn.className = "check-btn";
  checkBtn.textContent = "í™•ì¸";

  row.appendChild(input);
  row.appendChild(checkBtn);
  centerArea.appendChild(row);

  const hintArea = document.createElement("div");
  hintArea.className = "hint-text";
  centerArea.appendChild(hintArea);

  const resultArea = document.createElement("div");
  resultArea.className = "result-text";
  centerArea.appendChild(resultArea);

  updateProgress(sentenceState.indexInOrder + 1, wordCount);

  checkBtn.onclick = () => {
    const v = input.value.trim().toLowerCase();
    const answer = item.word.toLowerCase();

    if (!v) return;

    if (v === answer) {
      input.style.background = "#f0fdf4";
      input.style.borderColor = "#22c55e";
      resultArea.textContent = "ì •ë‹µì´ì—ìš”! ğŸ‘";
      hintArea.textContent = "";
      setTimeout(() => {
        nextSentenceQuestion();
      }, 900);
    } else {
      input.style.background = "#fef2f2";
      input.style.borderColor = "#f97373";
      const first = answer.charAt(0);
      hintArea.textContent = `íŒíŠ¸: "${first}" ë¡œ ì‹œì‘í•´ìš”.`;
      resultArea.textContent = "ë‹¤ì‹œ í•œ ë²ˆ ìƒê°í•´ ë³¼ê¹Œìš”?";
    }
  };
}

/* -------------------------------
   6. ëª¨ë“œ ì „í™˜ & ì´ˆê¸°í™”
-------------------------------- */
function setActiveTab(mode) {
  modeTabs.forEach(tab => {
    tab.classList.toggle("active", tab.dataset.mode === mode);
  });
}

function renderByMode() {
  clearTimer();
  stopSpeech();

  if (!wordCount) {
    centerArea.innerHTML = `<div>ì´ ìœ ë‹›ì— ëŒ€í•œ ë‹¨ì–´ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
    progressText.textContent = "-";
    modeInfo.textContent = "";
    return;
  }

  if (currentMode === "study") {
    startStudyMode();
  } else if (currentMode === "meaning") {
    initChoiceMode("meaning");
  } else if (currentMode === "english") {
    initChoiceMode("english");
  } else if (currentMode === "listening") {
    initChoiceMode("listening");
  } else if (currentMode === "sentence") {
    startSentenceMode();
  }
}

/* íƒ­ í´ë¦­ */
modeTabs.forEach(tab => {
  tab.onclick = () => {
    const mode = tab.dataset.mode;
    if (currentMode === mode) return;
    currentMode = mode;
    setActiveTab(mode);
    renderByMode();
  };
});

/* ì´ ëª¨ë“œ ë‹¤ì‹œ ì‹œì‘ */
resetModeBtn.onclick = () => {
  renderByMode();
};

/* ìµœì´ˆ ë Œë” */
renderByMode();
</script>
</body>
</html>